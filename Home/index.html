<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Options & Company</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link rel="shortcut icon" href="images/logo.png" type="image/x-icon"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet"/>

  <style>
    /* ===== Scrollbar personalizada (Chrome/Edge/Safari) ===== */
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-track { background: #1a1a1a; }
    ::-webkit-scrollbar-thumb { background: #418D75; border-radius: 6px; }
    ::-webkit-scrollbar-thumb:hover { background: #2e6b56; }
    /* ===== Firefox ===== */
    * { scrollbar-width: thin; scrollbar-color: #418D75 #1a1a1a; }

    /* --- Reset Básico e Configurações Globais --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f2a29;
      color: #ffffff;
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }
    .font-logo{ font-family: serif; }
    .e-comercial{ color: #4EA788; }

    /* --- Efeito de Fundo --- */
    body::before {
      content: '';
      position: absolute; inset: 0;
      background-image:
        linear-gradient(135deg, rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(225deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 30px 30px;
      z-index: 0;
    }
    .background-text { position: absolute; top: 0; right: 0; margin-top: -2rem; margin-right: -3rem; user-select: none; z-index: 0; }
    .background-text span { font-family: 'Playfair Display', serif; font-size: 20vw; font-weight: 700; color: rgba(255,255,255,0.05); transform: rotate(-12deg); display: inline-block; }

    /* --- Estrutura Principal --- */
    .container { position: relative; z-index: 1; min-height: 100vh; display: flex; flex-direction: column; max-width: 1280px; margin: 0 auto; padding: 0 1rem; }

    /* ===== TOPO ===== */
    .header { width: 100%; padding-top: 1rem; position: relative; margin-bottom: 20px; }
    .header-content {
      position: relative;
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 10px 20px 16px; gap: 16px; min-height: 72px; flex-wrap: nowrap;
    }

    /* Esquerda: Menu + Ferramentas */
    .top-left { display: flex; gap: 12px; align-items: center; flex: 0 0 auto; z-index: 5; }

    .menu-btn {
      border: 1px solid rgba(255,255,255,0.5);
      background: transparent; color: white;
      border-radius: 0.375rem; padding: 0.375rem 1rem;
      font-size: 0.875rem; cursor: pointer; transition: background-color .2s;
    }
    .menu-btn:hover { background-color: rgba(255,255,255,0.1); }

    /* Ferramentas (dropdown) */
    .google-tools { position: relative; display: flex; align-items: center; gap: 0.5rem; font-size: 0.75rem; }
    .google-tools > button {
      background: white; color: black; font-weight: 700; border: none; border-radius: .375rem;
      padding: .375rem .75rem; cursor: pointer; transition: background-color .2s;
    }
    .google-tools > button:hover { background: #e5e5e5; }

    .dropdown-content {
      display: none; position: absolute; right: 0; top: 100%; margin-top: 8px;
      background: #122D32; min-width: 180px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      z-index: 10; border-radius: 6px; padding: 4px 0; opacity: 0; transform: translateY(-10px);
      transition: opacity .2s ease, transform .2s ease; pointer-events: none; overflow: hidden;
    }
    .dropdown-content.show { display: block; opacity: 1; transform: translateY(0); pointer-events: auto; }
    .dropdown-content a {
      color: #fff; padding: 10px 16px; text-decoration: none; display: flex; align-items: center;
      font-size: 14px; transition: background-color .2s, color .2s;
    }
    .dropdown-content a:hover { background: #1c4a48; color: #fff; }
    .dropdown-content img { width: 16px; height: 16px; margin-right: 10px; }

    /* CENTRO: busca (agora no centro absoluto) */
    .site-search {
      position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
      display: flex; align-items: center; gap: 8px; z-index: 4; flex: 0 0 auto;
    }
    .search-wrap { position: relative; }
    .search-wrap .search-icon{ position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; opacity: .9; pointer-events: none; filter: drop-shadow(0 0 0 rgba(0,0,0,0)); }
    .site-search input[type="search"]{
      width: clamp(220px, 50vw, 520px);
      padding: 10px 12px; padding-left: 36px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: #fff; border-radius: 10px; outline: none;
    }
    .site-search input[type="search"]::placeholder { color: rgba(255,255,255,0.7); }
    .site-search button[type="submit"]{ padding: 10px 14px; border-radius: 10px; border: 0; background: #418D75; color: #fff; font-weight: 600; cursor: pointer; }

    /* SUGESTÕES */
    .suggest-panel{ position: absolute; top: calc(100% + 6px); left: 0; right: 0; z-index: 50; background: #232323; border: 1px solid rgba(255,255,255,0.12); border-radius: 10px; box-shadow: 0 18px 40px rgba(0,0,0,.28); padding: 6px; max-height: min(50vh, 420px); overflow: auto; }
    .suggest-empty{ padding: 10px 12px; color: rgba(255,255,255,0.7); font-size: 14px; }
    .suggest-item{ display: grid; grid-template-columns: 28px 1fr auto auto; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 8px; cursor: pointer; }
    .suggest-item:hover, .suggest-item[aria-selected="true"]{ background: rgba(255,255,255,0.08); }
    .suggest-icon{ width: 18px; height: 18px; border-radius: 4px; display: inline-block; background: rgba(255,255,255,0.12); }
    .suggest-text{ display: flex; flex-direction: column; min-width: 0; }
    .suggest-primary{ color: #fff; font-size: 14px; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .suggest-secondary{ color: rgba(255,255,255,0.65); font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 2px; }
    .suggest-badge{ font-size: 11px; padding: 3px 6px; border-radius: 999px; background: rgba(65,141,117,0.18); color: #a6e0cf; border: 1px solid rgba(65,141,117,0.35); margin-left: 8px; }
    .suggest-remove{ font-size: 16px; line-height: 1; padding: 2px 6px; color: rgba(255,255,255,0.65); cursor: pointer; user-select: none; }
    .suggest-remove:hover{ color: #ff6b6b; }

    /* DIREITA: logo */
    .header-titles-desktop { flex: 0 0 auto; display: flex; justify-content: flex-end; align-items: center; z-index: 3; text-align: right; }
    .header-titles-desktop .logo { max-height: 50px; width: auto; object-fit: contain; display: block; }

    .header-titles-mobile { display: none; }

    /* --- Conteúdo Principal --- */
    .main-content { flex-grow: 1; display: flex; align-items: stretch; justify-content: center; padding: 0; }

    /* ---- TAB PANELS ---- */
    .tab-panel { display: none; width: 100%; }
    .tab-panel.active { display: block; }
    .tab-placeholder {
      width: 100%;
      min-height: 60vh;
      display: grid;
      place-items: center;
      border: 1px dashed rgba(255,255,255,.15);
      border-radius: 12px;
      margin: 8px 0 16px;
      background: rgba(255,255,255,0.03);
      text-align: center;
      padding: 32px;
      color: rgba(255,255,255,0.75);
    }

    /* --- MENU LATERAL (Sidebar) --- */
    .sidebar {
      position: fixed; inset: 0 auto 0 0;
      width: min(82vw, 360px); transform: translateX(-100%);
      background: #0f2a29; color: #fff; padding: 16px;
      box-shadow: 2px 0 8px rgba(0,0,0,.35); transition: transform .30s ease;
      z-index: 1000; border-right: 1px solid rgba(255,255,255,.1); backdrop-filter: saturate(120%);
    }
    .sidebar.is-open { transform: translateX(0); }
    .sidebar-header { display: flex; align-items: center; justify-content: space-between; gap: 1rem; border-bottom: 1px solid rgba(255,255,255,.12); padding-bottom: .5rem; margin-bottom: .75rem; }
    .sidebar-header h2 { margin: 0; font-size: 1.2rem; }
    .close-btn { background: transparent; color: #fff; border: none; font-size: 1.8rem; line-height: 1; cursor: pointer; border-radius: 8px; padding: .2rem .4rem; }
    .close-btn:hover { background: rgba(255,255,255,.08); }
    .sidebar-links { display: flex; flex-direction: column; gap: .25rem; }
    .sidebar-links a { color: #fff; text-decoration: none; padding: .65rem .6rem; border-radius: 8px; }
    .sidebar-links a:hover { background: #123c38; color: #d1fae5; }

    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); opacity: 0; visibility: hidden; transition: .25s ease; z-index: 999; }
    .overlay.is-open { opacity: 1; visibility: visible; }

    /* ===== Imagem única na Home ===== */
    .tab-media-wrap{
      width: 100%;
      height: 70vh;
      border-radius: 12px;
      overflow: hidden;
      margin: 8px 0 16px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,.15);
    }
    .tab-media-wrap img{
      width: 100%;
      height: 100%;
      object-fit: cover; /* ocupa toda a área sem distorcer */
      display: block;
    }

    html, body { overflow-x: hidden; }

    /* ===== Responsivo ===== */
    @media (max-width: 640px){
      .header-content{ flex-wrap: wrap; gap: 8px 12px; padding: 8px 12px; }
      .top-left{ order: 1; }
      .site-search{
        position: static; transform: none; order: 2; width: 100%; margin-top: 4px;
        justify-content: center;
      }
      .site-search input[type="search"]{ width: 100%; max-width: 100%; }
      .header-titles-desktop{
        order: 3; width: 100%; display: flex; justify-content: flex-end; text-align: right; margin-top: 6px;
      }
      .search-wrap .search-icon{ left: 12px; }
      .header-titles-desktop .logo{ max-height: 50px; }
    }

    @media (min-width: 768px) {
      .header-titles-desktop { display: flex; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Cabeçalho -->
    <header class="header">
      <div class="header-content">

        <!-- Esquerda: Menu + Ferramentas -->
        <div class="top-left">
          <button class="menu-btn" id="menu-toggle" aria-expanded="false" aria-controls="sidebar">Menu</button>

          <div class="google-tools">
            <button id="google-button" aria-controls="google-dropdown" aria-expanded="false">Ferramentas</button>

            <div id="google-dropdown" class="dropdown-content" role="menu" aria-hidden="true">
              <a href="https://www.google.com" target="_blank" role="menuitem">
                <img src="images/favicon_google.ico" alt="">Home
              </a>
              <a href="https://calendar.google.com" target="_blank" role="menuitem">
                <img src="images/favicon_calendar.ico" alt="">Agenda
              </a>
              <a href="https://mail.google.com" target="_blank" role="menuitem">
                <img src="images/favicon_gmail.ico" alt="">Gmail
              </a>
              <a href="https://docs.google.com/spreadsheets/" target="_blank" role="menuitem">
                <img src="images/favicon_sheets.ico" alt="">Planilha
              </a>
              <a href="https://meet.google.com" target="_blank" role="menuitem">
                <img src="images/favicon_meet.ico" alt="">Google Meet
              </a>
              <a href="https://chatgpt.com/" target="_blank" role="menuitem">
                <img src="images/favicon_chagpt.ico" alt="">ChatGPT
              </a>
            </div>
          </div>
        </div>

        <!-- Centro: Busca -->
        <form class="site-search" role="search" aria-label="Pesquisar na web"
              action="https://www.google.com/search" method="GET" target="_self" id="search-form">
          <div class="search-wrap">
            <img src="images/favicon_google.ico" alt="" class="search-icon" aria-hidden="true">
            <input id="q" name="q" type="search" placeholder="Pesquisar no Google…"
                   autocomplete="off" inputmode="search" spellcheck="false" aria-controls="suggestions" />
            <div id="suggestions" class="suggest-panel" role="listbox" aria-label="Sugestões" hidden></div>
          </div>
          <button type="submit" aria-label="Pesquisar">Buscar</button>
        </form>

        <!-- Direita: Logo -->
        <div class="header-titles-desktop" aria-hidden="false">
          <!--<h1 class="font-logo">Options<br><span class="e-comercial">&</span> Company</h1>-->
          <img src="images/logo_texto_recortado.png" alt="Logo Options & Company" class="logo">
        </div>

      </div>
    </header>

    <!-- Conteúdo Principal em Abas -->
    <main class="main-content" id="tab-root" role="region" aria-live="polite">
      <!-- Início (padrão) -->
      <section id="tab-home" class="tab-panel active" role="tabpanel" aria-labelledby="tablink-home">
        <div class="tab-media-wrap">
          <img src="images/mesa_img.jpg" alt="Mesa de operação - Options & Company" loading="eager" fetchpriority="high">
        </div>
      </section>

      <!-- Indicadores -->
      <section id="tab-indicadores" class="tab-panel" role="tabpanel" aria-labelledby="tablink-indicadores">
        <div class="frame-wrap">
          <iframe
            title="Dashboard Looker Studio"
            src="https://lookerstudio.google.com/embed/reporting/54b7c921-72e4-44a0-afe2-152eb1c9f98e/page/p_dz2a2qtivd"
            style="width:100%; height:70vh; border:0;"
            sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox">
          </iframe>
        </div>
      </section>
    </main>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar" aria-hidden="true">
    <div class="sidebar-header">
      <h2>Menu</h2>
      <button class="close-btn" id="close-sidebar" aria-label="Fechar menu">×</button>
    </div>
    <nav class="sidebar-links">

      <a href="#home" id="tablink-home" data-tab-target="home" aria-controls="tab-home">Início</a>

      <a href="#indicadores" id="tablink-indicadores" data-tab-target="indicadores" aria-controls="tab-indicadores">Indicadores</a>

      <a href="https://chamadoadm.netlify.app" id="link-chamado-ti" target="_blank" rel="noopener">Suporte</a>
      <a href="https://bibliotecaco.netlify.app/" id="link-biblioteca" target="_blank" rel="noopener">Biblioteca</a>
    </nav>
  </aside>
  <div class="overlay" id="overlay" hidden></div>

  <!-- ===== Scripts ===== -->
<script>
/* ===================== Dropdown Ferramentas ===================== */
(() => {
  const btn = document.getElementById('google-button');
  const dd  = document.getElementById('google-dropdown');

  if (!btn || !dd) return;

  const close = () => {
    dd.classList.remove('show');
    btn.setAttribute('aria-expanded', 'false');
    dd.setAttribute('aria-hidden', 'true');
  };

  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    dd.classList.toggle('show');
    const open = dd.classList.contains('show');
    btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    dd.setAttribute('aria-hidden', open ? 'false' : 'true');
  });

  document.addEventListener('click', (e) => {
    if (!dd.classList.contains('show')) return;
    if (!dd.contains(e.target) && e.target !== btn) close();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') close();
  });
})();

/* ===================== Sidebar (Menu) ===================== */
(() => {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const openBtn = document.getElementById('menu-toggle');
  const closeBtn = document.getElementById('close-sidebar');

  if (!sidebar || !overlay) return;

  const setOpen = (v) => {
    sidebar.classList.toggle('is-open', v);
    overlay.classList.toggle('is-open', v);
    overlay.hidden = !v;
    sidebar.setAttribute('aria-hidden', v ? 'false' : 'true');
    openBtn?.setAttribute('aria-expanded', v ? 'true' : 'false');
  };

  openBtn?.addEventListener('click', () => setOpen(true));
  closeBtn?.addEventListener('click', () => setOpen(false));
  overlay?.addEventListener('click', () => setOpen(false));
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') setOpen(false); });

  // expõe para outros módulos (ex.: fechar ao trocar de aba)
  window.__closeSidebar = () => setOpen(false);
})();

/* ===================== Sistema de Abas (menu) ===================== */
(() => {
  const TAB_STORAGE_KEY = 'lastTab_v1';
  const panels = {
    home:        document.getElementById('tab-home'),
    indicadores: document.getElementById('tab-indicadores'),
  };

  function activate(tab) {
    Object.keys(panels).forEach(k => {
      panels[k]?.classList.toggle('active', k === tab);
      if (panels[k]) {
        const labelledby = panels[k].getAttribute('aria-labelledby');
        if (labelledby) {
          const link = document.getElementById(labelledby);
          if (link) link.setAttribute('aria-current', k === tab ? 'page' : 'false');
        }
      }
    });
    try { localStorage.setItem(TAB_STORAGE_KEY, tab); } catch {}
    window.__closeSidebar?.();
    if (tab === 'home')        history.replaceState(null, '', '#home');
    if (tab === 'indicadores') history.replaceState(null, '', '#indicadores');
  }

  // Clique em links do menu com data-tab-target="home|indicadores"
  document.querySelectorAll('[data-tab-target]').forEach(a => {
    a.addEventListener('click', (e) => {
      e.preventDefault();
      const tab = a.getAttribute('data-tab-target');
      if (tab && panels[tab]) activate(tab);
    });
  });

  // Inicial pelo hash ou storage
  function initFromHashOrStorage() {
    const hash = (location.hash || '').replace('#','').toLowerCase();
    if (hash && panels[hash]) { activate(hash); return; }
    try {
      const saved = localStorage.getItem(TAB_STORAGE_KEY);
      if (saved && panels[saved]) { activate(saved); return; }
    } catch {}
    activate('home');
  }

  window.addEventListener('hashchange', () => {
    const hash = (location.hash || '').replace('#','').toLowerCase();
    if (hash && panels[hash]) activate(hash);
  });

  initFromHashOrStorage();
  window.openTab = activate; // opcional: abrir via JS
})();

/* ===================== Autocomplete + recentes ===================== */
(() => {
  const INPUT_SEL = "#q";
  const PANEL_SEL = "#suggestions";
  const FORM_SEL  = "#search-form";

  const RECENTS_KEY   = "recentSearches_v1";
  const MAX_RECENTS   = 10;
  const SUGGEST_LIMIT = 10;

  // Catálogo de sites (removi duplicado do Flex Scan)
  const STANDARD_SITES = [
    { name: "Google",       domain: "google.com",        category: "Busca" },
    { name: "YouTube",      domain: "youtube.com",       category: "Vídeos" },
    { name: "Facebook",     domain: "facebook.com",      category: "Rede social" },
    { name: "Instagram",    domain: "instagram.com",     category: "Rede social" },
    { name: "ChatGPT",      domain: "chatgpt.com",       category: "Inteligência artificial" },
    { name: "X",            domain: "x.com",             category: "Rede social" },
    { name: "Amazon",       domain: "amazon.com",        category: "Comércio eletrônico" },
    { name: "LinkedIn",     domain: "linkedin.com",       category: "Rede social profissional" },
    { name: "Netflix",      domain: "netflix.com",       category: "Streaming de filmes e séries" },
    { name: "Gemini",       domain: "gemini.google.com", category: "IA do Google" },
    { name: "InfoMoney",    domain: "infomoney.com.br",  category: "Finanças" },
    { name: "CNN",          domain: "cnn.com",           category: "Notícias gerais e economia" },
    { name: "Looker Studio",domain: "lookerstudio.google.com", category: "Análise de dados" },
    { name: "Google Sheets",domain: "sheets.google.com",       category: "Planilhas" },
    { name: "WhatsApp Web", domain: "web.whatsapp.com",        category: "Mensagens" },
    { name: "Formulários Google", domain: "forms.google.com",  category: "Formulários" },
    { name: "Canva",        domain: "canva.com",               category: "Design gráfico" },
    { name: "Wikipedia",    domain: "wikipedia.org",           category: "Enciclopédia" },
    { name: "Pinterest",    domain: "pinterest.com",           category: "Rede social" },
    { name: "Globo",        domain: "globo.com",               category: "Portal / Notícias" },
    { name: "Telegram",     domain: "t.me",                    category: "Mensagens" },
    { name: "The New York Times", domain: "nytimes.com",       category: "Portal / Notícias" },
    { name: "AliExpress",   domain: "aliexpress.com",          category: "Comércio eletrônico" },
    { name: "Discord",      domain: "discord.com",             category: "Comunicação / Voz e texto" },
    { name: "BBC",          domain: "bbc.com",                 category: "Notícias internacionais" },
    { name: "Speedtest by Ookla", domain: "speedtest.net",     category: "Teste de velocidade" },
    { name: "Gmail",        domain: "mail.google.com",         category: "E-mail" },
    { name: "Google Drive", domain: "drive.google.com",        category: "Armazenamento em nuvem" },
    { name: "Google Docs",  domain: "docs.google.com",         category: "Documentos" },
    { name: "Google Slides",domain: "slides.google.com",       category: "Apresentações" },
    { name: "Google Keep",  domain: "keep.google.com",         category: "Anotações" },
    { name: "Google Calendar", domain: "calendar.google.com",  category: "Agenda" },
    { name: "Google Meet",  domain: "meet.google.com",         category: "Videoconferência" },
    { name: "Google Chat",  domain: "chat.google.com",         category: "Mensagens" },
    { name: "Google Maps",  domain: "maps.google.com",         category: "Mapas e navegação" },
    { name: "Google Earth", domain: "earth.google.com",        category: "Mapas e visualização 3D" },
    { name: "Google Translate", domain: "translate.google.com",category: "Tradução" },
    { name: "Google Photos",domain: "photos.google.com",       category: "Fotos e álbuns" },
    { name: "Google News",  domain: "news.google.com",         category: "Notícias" },
    { name: "Google Finance", domain: "google.com/finance",    category: "Finanças" },
    { name: "Google Flights", domain: "google.com/flights",    category: "Viagens" },
    { name: "Google Books", domain: "books.google.com",        category: "Livros" },
    { name: "Google Play",  domain: "play.google.com",         category: "Loja de apps e mídia" },
    { name: "Google Podcasts", domain: "podcasts.google.com",  category: "Podcasts" },
    { name: "Google Classroom",domain:"classroom.google.com",  category: "Educação" },
    { name: "Google Arts & Culture",domain:"artsandculture.google.com", category:"Arte e cultura" },
    { name: "Google Ads",   domain: "ads.google.com",          category: "Publicidade" },
    { name: "Google Analytics", domain:"analytics.google.com", category: "Métricas e estatísticas" },
    { name: "Google Tag Manager", domain:"tagmanager.google.com", category:"Gerenciamento de tags" },
    { name: "Google Cloud", domain: "cloud.google.com",        category: "Serviços em nuvem" },
    { name: "Google Colab", domain: "colab.research.google.com", category: "Notebooks de IA" },
    { name: "Spotify",      domain: "spotify.com",             category: "Streaming de música" },
    { name: "YouTube Music",domain: "music.youtube.com",       category: "Streaming de música" },
    { name: "Tryd",         domain: "tryd.com.br",             category: "Tryd" },
    { name: "Fast trade",   domain: "plataformafasttrade.com.br", category: "Fast Trade" },
    { name: "Chat Guru",    domain: "chatguru.com.br",         category: "Chat Guru" },
    { name: "Brasil Jornal",domain: "braziljournal.com",       category: "Notícias" },
    { name: "Flex Scan",    domain: "login.flexscan.com.br",   category: "Flexscan" },
    { name: "Git Hub",      domain: "github.com",              category: "Git Hub" },
  ];

  const SHORTCUTS = [
    { re: /^y(t|o|outube)?$/i, items: ["YouTube", "youtube.com"] },
    { re: /^g(mail)?$/i,      items: ["Gmail", "mail.google.com"] },
    { re: /^c(al|alendar)?$/i,items: ["Google Calendar", "calendar.google.com"] },
    { re: /^m(eet)?$/i,       items: ["Google Meet", "meet.google.com"] },
    { re: /^(d|drive)$/i,     items: ["Google Drive", "drive.google.com"] },
    { re: /^(s|sheets?)$/i,   items: ["Google Sheets", "docs.google.com/spreadsheets/"] },
  ];

  /* ---------- Helpers ---------- */
  const normalize = (s) =>
    (s || "").toString().normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

  const tokensFrom = (q) => normalize(q).split(/\s+/).filter(t => t.length >= 2);

  const looksLikeUrl = (text) => {
    const t = text.trim();
    return /\./.test(t) && !/\s/.test(t);
  };

  const domainFrom = (text) => {
    try {
      const url = /^https?:\/\//i.test(text) ? text : "https://" + text;
      return new URL(url).hostname;
    } catch { return null; }
  };

  const faviconFor = (value) => {
    const host = domainFrom(value);
    return host ? `https://www.google.com/s2/favicons?domain=${host}&sz=32` : null;
  };

  const uniqBy = (arr, keyFn) => {
    const seen = new Set(); const out = [];
    for (const v of arr) {
      const k = keyFn(v);
      if (!seen.has(k)) { seen.add(k); out.push(v); }
    }
    return out;
  };

  const getRecents = () => {
    try { return JSON.parse(localStorage.getItem(RECENTS_KEY) || "[]"); }
    catch { return []; }
  };

  const saveRecent = (q) => {
    const t = q.trim();
    if (!t) return;
    let arr = getRecents().filter(v => v.toLowerCase() !== t.toLowerCase());
    arr.unshift(t);
    if (arr.length > MAX_RECENTS) arr = arr.slice(0, MAX_RECENTS);
    localStorage.setItem(RECENTS_KEY, JSON.stringify(arr));
  };

  const removeRecent = (label) => {
    const tgt = (label || "").trim().toLowerCase();
    const arr = getRecents().filter(v => v.toLowerCase() !== tgt);
    localStorage.setItem(RECENTS_KEY, JSON.stringify(arr));
  };

  const fetchGoogleSuggest = async (q) => {
    if (!q) return [];
    const url = `https://suggestqueries.google.com/complete/search?client=firefox&hl=pt-BR&q=${encodeURIComponent(q)}`;
    try {
      const res = await fetch(url, { mode: "cors" });
      if (!res.ok) return [];
      const data = await res.json();
      return Array.isArray(data?.[1]) ? data[1] : [];
    } catch { return []; }
  };

  const itemModel = (label, type = "sugestao", opts = {}) => {
    const isUrl = opts.fillValue ? looksLikeUrl(opts.fillValue) : looksLikeUrl(label);
    return {
      label,
      subtitle: opts.subtitleOverride ??
        (isUrl ? (opts.fillValue || label).replace(/^https?:\/\//i, "")
               : (type === "atalho" ? "Atalho" : type === "recente" ? "Recente" : "Sugestão")),
      badge: type === "atalho" ? "Atalho" : type === "recente" ? "Recente" : "Sugestão",
      icon: opts.iconOverride ?? (isUrl ? (faviconFor(opts.fillValue || label) || "") : "images/favicon_google.ico"),
      type,
      isUrl,
      fillValue: opts.fillValue || label,
    };
  };

  const standardSiteModels = (q) => {
    if (!q) return [];
    const s = normalize(q);
    return STANDARD_SITES
      .filter(site => {
        const n = normalize(site.name);
        const d = normalize(site.domain);
        if (s.length === 1) return n.startsWith(s);
        const toks = tokensFrom(q);
        const hay = n + " " + d;
        return toks.every(t => hay.includes(t));
      })
      .map(site => itemModel(site.name, "atalho", {
        subtitleOverride: `${site.domain}`,
        iconOverride: faviconFor(site.domain),
        fillValue: site.domain
      }));
  };

  const modelMatchesQuery = (m, q) => {
    const s = normalize(q || "");
    if (!s) return false;
    const base = normalize((m.fillValue || (m.label + " " + (m.subtitle || ""))));
    if (s.length === 1) {
      const dom = normalize((m.subtitle || "").split(" — ")[0] || "");
      return base.startsWith(s) || dom.startsWith(s);
    }
    return s.split(/\s+/).filter(Boolean).every(t => base.includes(t));
  };

  const PANEL = () => document.querySelector(PANEL_SEL);

  const renderPanel = (models, activeIndex = -1) => {
    const panel = PANEL();
    if (!panel) return;
    panel.innerHTML = "";

    if (!models.length) {
      panel.hidden = false;
      const div = document.createElement("div");
      div.className = "suggest-empty";
      div.textContent = "Sem sugestões";
      panel.appendChild(div);
      return;
    }

    models.slice(0, SUGGEST_LIMIT).forEach((m, idx) => {
      const el = document.createElement("div");
      el.className = "suggest-item";
      el.setAttribute("role", "option");
      el.dataset.index = String(idx);
      if (idx === activeIndex) el.setAttribute("aria-selected", "true");

      const icon = document.createElement("img");
      icon.className = "suggest-icon";
      icon.alt = "";
      icon.referrerPolicy = "no-referrer";
      if (m.icon) icon.src = m.icon; else icon.style.visibility = "hidden";

      const textWrap = document.createElement("div");
      textWrap.className = "suggest-text";

      const primary = document.createElement("div");
      primary.className = "suggest-primary";
      primary.textContent = m.label;

      const secondary = document.createElement("div");
      secondary.className = "suggest-secondary";
      secondary.textContent = m.subtitle;

      textWrap.append(primary, secondary);

      const badge = document.createElement("div");
      badge.className = "suggest-badge";
      badge.textContent = m.badge;

      el.append(icon, textWrap, badge);

      if (m.type === "recente") {
        const removeBtn = document.createElement("div");
        removeBtn.className = "suggest-remove";
        removeBtn.textContent = "×";
        removeBtn.addEventListener("mousedown", (e) => e.preventDefault());
        removeBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          removeRecent(m.fillValue || m.label);
          el.remove();
          if (!panel.querySelector(".suggest-item")) {
            panel.innerHTML = "";
            const empty = document.createElement("div");
            empty.className = "suggest-empty";
            empty.textContent = "Sem sugestões";
            panel.appendChild(empty);
          }
        });
        el.appendChild(removeBtn);
      }

      el.addEventListener("mousedown", (e) => e.preventDefault());
      el.addEventListener("click", () => applySuggestion(m));

      panel.appendChild(el);
    });

    panel.hidden = false;
  };

  const hidePanel = () => { const p = PANEL(); if (p) p.hidden = true; };

  const applySuggestion = (m) => {
    const input = document.querySelector(INPUT_SEL);
    if (!input) return;
    input.value = m.fillValue || m.label;
    input.setSelectionRange(input.value.length, input.value.length);
    hidePanel();
  };

  let suppressInlineNext = false;

  const shouldSuppressInline = (inputEl) =>
    inputEl.selectionStart !== inputEl.selectionEnd ||
    inputEl.selectionStart !== inputEl.value.length;

  const inlineComplete = (typed, models, byKeyboard = false) => {
    const input = document.querySelector(INPUT_SEL);
    if (!input || !typed) return;
    if (byKeyboard || suppressInlineNext || shouldSuppressInline(input)) return;

    const cand = models.find(m =>
      (m.fillValue || m.label).toLowerCase().startsWith(typed.toLowerCase())
    );
    if (!cand) return;

    const toShow = cand.fillValue || cand.label;
    input.value = toShow;
    try { input.setSelectionRange(typed.length, toShow.length); } catch {}
  };

  let activeIndex = -1;
  let currentModels = [];

  const debounce = (fn, ms = 120) => {
    let id;
    return (...args) => { clearTimeout(id); id = setTimeout(() => fn(...args), ms); };
  };

  const refreshSuggestions = async (byKeyboard = false, inputEvent = null) => {
    const input = document.querySelector(INPUT_SEL);
    const q = (input?.value || "").trim();

    if (inputEvent?.inputType?.startsWith?.("delete")) suppressInlineNext = true;
    if (inputEvent?.ctrlKey || inputEvent?.metaKey || inputEvent?.altKey) suppressInlineNext = true;

    const stdModels = standardSiteModels(q);

    const rec = getRecents();
    const short = applyShortcuts(q);
    const remote = q ? await fetchGoogleSuggest(q) : [];
    const stringPool = q ? Array.from(new Set([...short, ...remote, ...rec])) : [];

    let otherModels = stringPool.map((s) =>
      itemModel(s, short.includes(s) ? "atalho" : rec.includes(s) ? "recente" : "sugestao")
    );

    otherModels = otherModels.filter(m => modelMatchesQuery(m, q));

    const allModels = otherModels.concat(stdModels);
    if (q && looksLikeUrl(q) &&
        !allModels.some(m => (m.fillValue || m.label).toLowerCase() === q.toLowerCase())) {
      otherModels.unshift(itemModel(q, "sugestao"));
    }

    currentModels = uniqBy([...stdModels, ...otherModels], (m) => (m.fillValue || m.label).toLowerCase());

    activeIndex = -1;
    if (q) {
      renderPanel(currentModels, activeIndex);
      inlineComplete(q, currentModels, byKeyboard);
    } else {
      hidePanel();
    }

    suppressInlineNext = false;
  };

  const debouncedRefresh = debounce((...args) => { refreshSuggestions(...args); }, 120);

  const handleKeyDown = (e) => {
    const panel = document.querySelector(PANEL_SEL);
    const input = document.querySelector(INPUT_SEL);

    if (e.key === "Backspace" || e.key === "Delete") suppressInlineNext = true;
    if (e.ctrlKey || e.metaKey || e.altKey) suppressInlineNext = true;

    if (!panel || panel.hidden) return;

    const max = Math.min(SUGGEST_LIMIT, currentModels.length) - 1;

    if (e.key === "ArrowDown") {
      e.preventDefault();
      activeIndex = activeIndex < max ? activeIndex + 1 : 0;
      renderPanel(currentModels, activeIndex);
      const m = currentModels[activeIndex];
      if (m) {
        const v = m.fillValue || m.label;
        input.value = v;
        input.setSelectionRange(v.length, v.length);
      }
    } else if (e.key === "ArrowUp") {
      e.preventDefault();
      activeIndex = activeIndex > 0 ? activeIndex - 1 : max;
      renderPanel(currentModels, activeIndex);
      const m = currentModels[activeIndex];
      if (m) {
        const v = m.fillValue || m.label;
        input.value = v;
        input.setSelectionRange(v.length, v.length);
      }
    } else if (e.key === "Tab") {
      const hasSelection = input.selectionStart !== input.selectionEnd;
      if (hasSelection && currentModels.length) {
        e.preventDefault();
        input.setSelectionRange(input.value.length, input.value.length);
        hidePanel();
      }
    } else if (e.key === "Enter") {
      hidePanel();
    } else if (e.key === "Escape") {
      hidePanel();
    }
  };

  const handleSubmit = (e) => {
    const input = document.querySelector(INPUT_SEL);
    const q = (input?.value || "").trim();
    if (!q) { e.preventDefault(); return; }
    saveRecent(q);
    if (looksLikeUrl(q)) {
      e.preventDefault();
      const url = /^https?:\/\//i.test(q) ? q : "https://" + q;
      window.location.assign(url);
    }
    // senão, o <form> envia para Google com name="q"
  };

  const focusInput = () => {
    const el = document.querySelector(INPUT_SEL);
    if (!el) return;
    if (document.visibilityState !== "visible") {
      document.addEventListener("visibilitychange", focusInput, { once: true });
      return;
    }
    el.focus({ preventScroll: true });
    try { el.select(); } catch {}
  };

  const focusWithRetries = (retries = 24, delay = 50) => {
    focusInput();
    let i = 1;
    const id = setInterval(() => {
      const ok = document.activeElement?.matches?.(INPUT_SEL);
      if (ok || i++ >= retries) clearInterval(id);
      else focusInput();
    }, delay);
  };

  const bindGlobalShortcuts = () => {
    window.addEventListener("keydown", (e) => {
      const typing = /input|textarea|select/i.test(e.target.tagName);
      if (typing) return;
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k") {
        e.preventDefault(); focusWithRetries(1, 0);
      } else if (!e.ctrlKey && !e.metaKey && !e.altKey && e.key === "/") {
        e.preventDefault(); focusWithRetries(1, 0);
      }
    });
  };

  const bindOutsideClick = () => {
    document.addEventListener("click", (e) => {
      const panel = document.querySelector(PANEL_SEL);
      const input = document.querySelector(INPUT_SEL);
      if (!panel || panel.hidden) return;
      if (!panel.contains(e.target) && e.target !== input) hidePanel();
    });
  };

  document.addEventListener("DOMContentLoaded", () => {
    const input = document.querySelector(INPUT_SEL);
    const panel = document.querySelector(PANEL_SEL);
    const form  = document.querySelector(FORM_SEL);
    if (!input || !panel || !form) return;

    focusWithRetries();

    // Mostrar "recentes" ao focar quando vazio (após pointerdown)
    let allowFocusRecents = false;
    input.addEventListener("pointerdown", () => { allowFocusRecents = true; });
    input.addEventListener("focus", () => {
      if (allowFocusRecents && !input.value.trim()) {
        const rec = getRecents().map((s) => itemModel(s, "recente"));
        if (rec.length) renderPanel(rec);
      }
    });

    input.addEventListener("input", (ev) => debouncedRefresh(false, ev));
    input.addEventListener("keydown", handleKeyDown);
    input.addEventListener("blur", () => setTimeout(hidePanel, 100));

    form.addEventListener("submit", handleSubmit);
    bindGlobalShortcuts();
    bindOutsideClick();
  });

  // atalhos (usa const SHORTCUTS do topo)
  const applyShortcuts = (q) => {
    const m = SHORTCUTS.find(s => s.re.test(q));
    return m ? m.items : [];
  };
})();
</script>
</body>
</html>
